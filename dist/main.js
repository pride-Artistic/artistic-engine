var ArtisticEngine;(()=>{"use strict";var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Engine:()=>a,Entity:()=>r,Sprite:()=>o,Vector:()=>i});var i={};t.r(i),t.d(i,{Vector2D:()=>n,Vector3D:()=>u,Vector4D:()=>c});class s{constructor(...t){this.values=[...t],this.size=t.length}get Size(){return this.size}copy(t,e=!1){if(this.size>t.size&&!e)throw new Error(`Copying vector of size ${this.size} to ${t.size} will cause data loss.\nInclude force option if intended.`);return t.overwrite(this.values),t}isequal(t,e){if(this.size!==t.size)return!1;const i=this.values.slice(),s=t.values.slice();return i.every(((t,i)=>null==e?t==s[i]:t.toFixed(e)==s[i].toFixed(e)))}shift(t=1){t%=this.size;const e=this.values.slice(0,-t);return e.unshift(...this.values.slice(-t)),this.values=e,this}overwrite(t){let e=0;this.values=this.values.map((function(){return t[e++]||0}))}}class n extends s{constructor(t=0,e=0){super(t,e)}get X(){return this.values[0]}get Y(){return this.values[1]}set X(t){this.values[0]=t}set Y(t){this.values[1]=t}}class r{constructor(t){var e,i,s,r;this.children=[],this.parent=null,this.dimension=new n,this.position=new n,t&&(this.dimension.X=null!==(e=t.W)&&void 0!==e?e:0,this.dimension.Y=null!==(i=t.H)&&void 0!==i?i:0,this.position.X=null!==(s=t.X)&&void 0!==s?s:0,this.position.Y=null!==(r=t.Y)&&void 0!==r?r:0)}get Position(){return this.position}get X(){return this.position.X}get Y(){return this.position.Y}get AbsoluteX(){var t,e;return(null!==(e=null===(t=this.parent)||void 0===t?void 0:t.AbsoluteX)&&void 0!==e?e:0)+this.position.X}get AbsoluteY(){var t,e;return(null!==(e=null===(t=this.parent)||void 0===t?void 0:t.AbsoluteY)&&void 0!==e?e:0)+this.position.Y}get Dimension(){return this.dimension}get W(){return this.dimension.X}get H(){return this.dimension.Y}get Width(){return this.dimension.X}get Height(){return this.dimension.Y}get Parent(){return this.parent}get Children(){return this.children.slice()}set Position(t){this.position=t}set X(t){this.position.X=t}set Y(t){this.position.Y=t}set Dimension(t){this.dimension=t}set W(t){this.dimension.X=t}set H(t){this.dimension.Y=t}set Width(t){this.dimension.X=t}set Height(t){this.dimension.Y=t}attachChildren(t,e=1/0){var i;let s=-1;if(Array.isArray(t)){const i=Math.max(0,Math.min(e,this.children.length));for(let e=0;e<t.length;e++)s=this.attachChildren(t[e],i+e)}else{for(let e=this;null!==e;e=e.parent)if(e===t)throw new Error("Loop of parent-child relationships detected.");null===(i=t.parent)||void 0===i||i.detachChildren(t),this.children.push(t),t.parent=this,s=this.setChildIndex(t,e)}return s}detachChildren(t){if(Array.isArray(t))for(const e of t)this.detachChildren(e);else{const e=this.children.indexOf(t);e>-1&&(this.children.splice(e,1),t.parent=null)}}getChildIndex(t){return this.children.indexOf(t)}setChildIndex(t,e){const i=this.getChildIndex(t);if(-1===i)throw new Error("I AM NOT YOUR FATHER");this.children.splice(i,1);const s=Math.max(0,Math.min(e,this.children.length));return this.children.splice(s,0,t),s}setParent(t=null){var e;null==t?null===(e=this.parent)||void 0===e||e.detachChildren(this):t.attachChildren(this)}}const h=t=>{if(null!=t.reset)return!0;t.save();let e=0;const i=t.save,s=t.restore;return t.save=function(){i.call(this),e++},t.restore=function(){e>0&&(s.call(this),e--)},t.reset=function(){!function(t){for(let i=e;i>-1;i--)s.call(t);e=-1}(t),this.moveTo(0,0),this.beginPath(),this.closePath(),this.resetTransform(),this.clearRect(0,0,this.canvas.width,this.canvas.height),this.save()},!1};class o extends r{constructor(){super(...arguments),this.draw=(t,e)=>{t.save(),this.region&&(this.beforeClip(t,e),t.beginPath(),t.rect(this.region.AbsoluteX,this.region.AbsoluteY,this.region.Width,this.region.Height),t.clip()),this.onDraw(t,e),t.restore(),this.afterRestore(t,e);for(const i of this.Children)i instanceof o&&i.draw(t,e)}}get Region(){return this.region}get isSelfRegion(){return this.region===this}set Region(t){this.region=t}beforeClip(t,e){}afterRestore(t,e){}}class l extends o{onDraw(){}}class a{constructor(t){let e;if(this.previousTimestamp=0,this.animationId=-1,this.scene=new l,e="string"==typeof t?document.querySelector(t):t,null===e)throw new Error("Unable to identify canvas.");this.canvas=e,this.subReset=()=>{};const i=this.canvas.getContext("2d");this.context=i,(t=>{const e={context_reset:h(this.Context)};Object.freeze(e)})()}get Canvas(){return this.canvas}get Context(){return this.context}get Scene(){return this.scene}set Scene(t){t instanceof r&&t.setParent(null),this.scene=t}setSubResetFunction(t){this.subReset=t}resizeCanvas(t){var e,i;t instanceof n?(this.Canvas.width=t.X,this.Canvas.height=t.Y):(this.Canvas.width=null!==(e=null==t?void 0:t.w)&&void 0!==e?e:window.innerWidth,this.Canvas.height=null!==(i=null==t?void 0:t.h)&&void 0!==i?i:window.innerHeight)}start(){this.render(this.previousTimestamp)}stop(){cancelAnimationFrame(this.animationId)}render(t){var e;const i=t-this.previousTimestamp;this.previousTimestamp=t,this.context.reset(),this.subReset(this.context),null===(e=this.scene)||void 0===e||e.draw(this.context,i),this.animationId=requestAnimationFrame(this.render.bind(this))}}class u extends s{constructor(t=0,e=0,i=0){super(t,e,i)}get X(){return this.values[0]}get Y(){return this.values[1]}get Z(){return this.values[2]}set X(t){this.values[0]=t}set Y(t){this.values[1]=t}set Z(t){this.values[2]=t}}class c extends s{constructor(t=0,e=0,i=0,s=0){super(t,e,i,s)}get X(){return this.values[0]}get Y(){return this.values[1]}get Z(){return this.values[2]}get W(){return this.values[3]}set X(t){this.values[0]=t}set Y(t){this.values[1]=t}set Z(t){this.values[2]=t}set W(t){this.values[3]=t}}ArtisticEngine=e})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU8sR0FBS29JLENBQ25CLEVDM0JhLE1BQU1FLFVBQWlCeEksRUFDcENDLFlBQVk0QixFQUFZLEVBQUdDLEVBQVksRUFBR3dHLEVBQVksRUFBR2QsRUFBWSxHQUNuRXpGLE1BQU1GLEVBQUdDLEVBQUd3RyxFQUFHZCxFQUNqQixDQUVXeEYsUUFDVCxPQUFPN0IsS0FBS0QsT0FBTyxFQUNyQixDQUVXK0IsUUFDVCxPQUFPOUIsS0FBS0QsT0FBTyxFQUNyQixDQUVXcUksUUFDVCxPQUFPcEksS0FBS0QsT0FBTyxFQUNyQixDQUVXc0MsUUFDVCxPQUFPckMsS0FBS0QsT0FBTyxFQUNyQixDQUVXOEIsTUFBRUgsR0FDWDFCLEtBQUtELE9BQU8sR0FBSzJCLENBQ25CLENBRVdJLE1BQUVILEdBQ1gzQixLQUFLRCxPQUFPLEdBQUs0QixDQUNuQixDQUVXeUcsTUFBRUQsR0FDWG5JLEtBQUtELE9BQU8sR0FBS29JLENBQ25CLENBRVc5RixNQUFFZ0YsR0FDWHJILEtBQUtELE9BQU8sR0FBS3NILENBQ25CLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9BcnRpc3RpY0VuZ2luZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9BcnRpc3RpY0VuZ2luZS93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vQXJ0aXN0aWNFbmdpbmUvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9BcnRpc3RpY0VuZ2luZS93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL0FydGlzdGljRW5naW5lLy4vc3JjL3ZlY3Rvci92ZWN0b3IudHMiLCJ3ZWJwYWNrOi8vQXJ0aXN0aWNFbmdpbmUvLi9zcmMvdmVjdG9yL3ZlY3RvcjJELnRzIiwid2VicGFjazovL0FydGlzdGljRW5naW5lLy4vc3JjL2VudGl0eS9lbnRpdHkudHMiLCJ3ZWJwYWNrOi8vQXJ0aXN0aWNFbmdpbmUvLi9zcmMvY29tcGF0aWJpbGl0eS9jb250ZXh0X3Jlc2V0LnRzIiwid2VicGFjazovL0FydGlzdGljRW5naW5lLy4vc3JjL3Nwcml0ZS9zcHJpdGUudHMiLCJ3ZWJwYWNrOi8vQXJ0aXN0aWNFbmdpbmUvLi9zcmMvc2NlbmVzL2JsYW5rX3NjZW5lLnRzIiwid2VicGFjazovL0FydGlzdGljRW5naW5lLy4vc3JjL2VuZ2luZS50cyIsIndlYnBhY2s6Ly9BcnRpc3RpY0VuZ2luZS8uL3NyYy9jb21wYXRpYmlsaXR5L2luZGV4LnRzIiwid2VicGFjazovL0FydGlzdGljRW5naW5lLy4vc3JjL3ZlY3Rvci92ZWN0b3IzRC50cyIsIndlYnBhY2s6Ly9BcnRpc3RpY0VuZ2luZS8uL3NyYy92ZWN0b3IvdmVjdG9yNEQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJleHBvcnQgZGVmYXVsdCBhYnN0cmFjdCBjbGFzcyBWZWN0b3Ige1xyXG4gIHByb3RlY3RlZCByZWFkb25seSBzaXplOiBudW1iZXI7XHJcblxyXG4gIHByb3RlY3RlZCB2YWx1ZXM6IG51bWJlcltdO1xyXG5cclxuICBjb25zdHJ1Y3RvciguLi52YWx1ZXM6IG51bWJlcltdKSB7XHJcbiAgICB0aGlzLnZhbHVlcyA9IFsuLi52YWx1ZXNdO1xyXG4gICAgdGhpcy5zaXplID0gdmFsdWVzLmxlbmd0aDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgU2l6ZSgpIHtcclxuICAgIHJldHVybiB0aGlzLnNpemU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY29weTxUIGV4dGVuZHMgVmVjdG9yPih0bzogVCwgZm9yY2U6IGJvb2xlYW4gPSBmYWxzZSk6IFQge1xyXG4gICAgaWYgKHRoaXMuc2l6ZSA+IHRvLnNpemUgJiYgIWZvcmNlKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcclxuICAgICAgICBgQ29weWluZyB2ZWN0b3Igb2Ygc2l6ZSAke3RoaXMuc2l6ZX0gdG8gJHt0by5zaXplfSB3aWxsIGNhdXNlIGRhdGEgbG9zcy5cXG5JbmNsdWRlIGZvcmNlIG9wdGlvbiBpZiBpbnRlbmRlZC5gXHJcbiAgICAgICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0by5vdmVyd3JpdGUodGhpcy52YWx1ZXMpO1xyXG4gICAgICByZXR1cm4gdG87XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNlcXVhbDxUIGV4dGVuZHMgVmVjdG9yPihvdGhlcjogVCwgcHJlY2lzZT86IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgaWYgKHRoaXMuc2l6ZSAhPT0gb3RoZXIuc2l6ZSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgY29uc3QgdGhpc0FycmF5ID0gdGhpcy52YWx1ZXMuc2xpY2UoKTtcclxuICAgIGNvbnN0IG90aGVyQXJyYXkgPSBvdGhlci52YWx1ZXMuc2xpY2UoKTtcclxuICAgIHJldHVybiB0aGlzQXJyYXkuZXZlcnkoKHYsIGkpID0+IHtcclxuICAgICAgaWYgKHByZWNpc2UgPT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiB2ID09IG90aGVyQXJyYXlbaV07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHYudG9GaXhlZChwcmVjaXNlKSA9PSBvdGhlckFycmF5W2ldLnRvRml4ZWQocHJlY2lzZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNoaWZ0KG1vdmU6IG51bWJlciA9IDEpIHtcclxuICAgIG1vdmUgJT0gdGhpcy5zaXplO1xyXG4gICAgY29uc3QgdGVtcCA9IHRoaXMudmFsdWVzLnNsaWNlKDAsIC1tb3ZlKTtcclxuICAgIHRlbXAudW5zaGlmdCguLi50aGlzLnZhbHVlcy5zbGljZSgtbW92ZSkpO1xyXG4gICAgLy8gSXQgY2hhbmdlcyBpdHNlbGYgKHJlZmVyZW5jZSksIGRvZXMgbm90IHJldHVybiBuZXcgdmFsdWVcclxuICAgIC8vIElmIHlvdSB3YW50IHRvIGxldCBpdCByZXR1cm4gbmV3IHZhbHVlLCB5b3Ugc2hvdWxkIG1vZGlmeSB0aGlzIHNlY3Rpb25cclxuICAgIHRoaXMudmFsdWVzID0gdGVtcDtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvdmVyd3JpdGUodmFsdWVzOiBudW1iZXJbXSkge1xyXG4gICAgbGV0IGNvdW50ZXIgPSAwO1xyXG4gICAgdGhpcy52YWx1ZXMgPSB0aGlzLnZhbHVlcy5tYXAoZnVuY3Rpb24gKCkge1xyXG4gICAgICBjb25zdCBuZXdWYWx1ZSA9IHZhbHVlc1tjb3VudGVyKytdO1xyXG4gICAgICBpZiAobmV3VmFsdWUpIHJldHVybiBuZXdWYWx1ZTtcclxuICAgICAgZWxzZSByZXR1cm4gMDtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgVmVjdG9yIGZyb20gXCIuL3ZlY3RvclwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmVjdG9yMkQgZXh0ZW5kcyBWZWN0b3Ige1xyXG4gIGNvbnN0cnVjdG9yKHg6IG51bWJlciA9IDAsIHk6IG51bWJlciA9IDApIHtcclxuICAgIHN1cGVyKHgsIHkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBYKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudmFsdWVzWzBdO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBZKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudmFsdWVzWzFdO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBYKHg6IG51bWJlcikge1xyXG4gICAgdGhpcy52YWx1ZXNbMF0gPSB4O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBZKHk6IG51bWJlcikge1xyXG4gICAgdGhpcy52YWx1ZXNbMV0gPSB5O1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBWZWN0b3IyRCB9IGZyb20gXCIuLi92ZWN0b3JcIjtcclxuaW1wb3J0IElFbnRpdHkgZnJvbSBcIi4vaWVudGl0eVwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRW50aXR5IGltcGxlbWVudHMgSUVudGl0eSB7XHJcbiAgcHJvdGVjdGVkIGNoaWxkcmVuOiBFbnRpdHlbXSA9IFtdO1xyXG5cclxuICBwcm90ZWN0ZWQgcGFyZW50OiBFbnRpdHkgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgcHJpdmF0ZSBkaW1lbnNpb246IFZlY3RvcjJEID0gbmV3IFZlY3RvcjJEKCk7XHJcblxyXG4gIHByaXZhdGUgcG9zaXRpb246IFZlY3RvcjJEID0gbmV3IFZlY3RvcjJEKCk7XHJcblxyXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcihjb25maWc/OiBJRW50aXR5IHwgdW5kZWZpbmVkKSB7XHJcbiAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgIHRoaXMuZGltZW5zaW9uLlggPSBjb25maWcuVyA/PyAwO1xyXG4gICAgICB0aGlzLmRpbWVuc2lvbi5ZID0gY29uZmlnLkggPz8gMDtcclxuICAgICAgdGhpcy5wb3NpdGlvbi5YID0gY29uZmlnLlggPz8gMDtcclxuICAgICAgdGhpcy5wb3NpdGlvbi5ZID0gY29uZmlnLlkgPz8gMDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgUG9zaXRpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wb3NpdGlvbjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgWCgpIHtcclxuICAgIHJldHVybiB0aGlzLnBvc2l0aW9uLlg7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IFkoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wb3NpdGlvbi5ZO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBBYnNvbHV0ZVgoKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IHBhcmVudFggPSB0aGlzLnBhcmVudD8uQWJzb2x1dGVYID8/IDA7XHJcbiAgICByZXR1cm4gcGFyZW50WCArIHRoaXMucG9zaXRpb24uWDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgQWJzb2x1dGVZKCk6IG51bWJlciB7XHJcbiAgICBjb25zdCBwYXJlbnRZID0gdGhpcy5wYXJlbnQ/LkFic29sdXRlWSA/PyAwO1xyXG4gICAgcmV0dXJuIHBhcmVudFkgKyB0aGlzLnBvc2l0aW9uLlk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IERpbWVuc2lvbigpIHtcclxuICAgIHJldHVybiB0aGlzLmRpbWVuc2lvbjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgVygpIHtcclxuICAgIHJldHVybiB0aGlzLmRpbWVuc2lvbi5YO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBIKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGltZW5zaW9uLlk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IFdpZHRoKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGltZW5zaW9uLlg7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IEhlaWdodCgpIHtcclxuICAgIHJldHVybiB0aGlzLmRpbWVuc2lvbi5ZO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBQYXJlbnQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wYXJlbnQ7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgZ2V0IENoaWxkcmVuKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY2hpbGRyZW4uc2xpY2UoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgUG9zaXRpb24ocG9zaXRpb246IFZlY3RvcjJEKSB7XHJcbiAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IFgoeDogbnVtYmVyKSB7XHJcbiAgICB0aGlzLnBvc2l0aW9uLlggPSB4O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBZKHk6IG51bWJlcikge1xyXG4gICAgdGhpcy5wb3NpdGlvbi5ZID0geTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgRGltZW5zaW9uKGRpbWVuc2lvbjogVmVjdG9yMkQpIHtcclxuICAgIHRoaXMuZGltZW5zaW9uID0gZGltZW5zaW9uO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBXKHdpZHRoOiBudW1iZXIpIHtcclxuICAgIHRoaXMuZGltZW5zaW9uLlggPSB3aWR0aDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgSChoZWlnaHQ6IG51bWJlcikge1xyXG4gICAgdGhpcy5kaW1lbnNpb24uWSA9IGhlaWdodDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgV2lkdGgod2lkdGg6IG51bWJlcikge1xyXG4gICAgdGhpcy5kaW1lbnNpb24uWCA9IHdpZHRoO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBIZWlnaHQoaGVpZ2h0OiBudW1iZXIpIHtcclxuICAgIHRoaXMuZGltZW5zaW9uLlkgPSBoZWlnaHQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGVzIHBhcmVudC1jaGlsZCByZWxhdGlvbiBiZXR3ZWVuIHRoaXMgZW50aXR5IGFuZCBlbnRpdGllcyBwYXNzZWQgdGhyb3VnaCB0aGUgcGFyYW1ldGVyLlxyXG4gICAqIElmIGNoaWxkcmVuIHBhc3NlZCBhbHJlYWR5IGhhcyBhIHBhcmVudCwgdGhlIHByZXZpb3VzIHJlbGF0aW9uIGlzIG92ZXJ3cml0dGVkLlxyXG4gICAqIHpfaW5kZXggY2FuIGJlIHNwZWNpZmllZCB0byBjb25maWd1cmUgcmVuZGVyaW5nIHNlcXVlbmNlIGJldHdlZW4gY2hpbGRyZW4uXHJcbiAgICogQHBhcmFtIGNoaWxkcmVuIFNpbmdsZSBlbnRpdHkgb3IgYW4gYXJyYXkgb2YgZW50aXRpZXMgdG8gYXR0YWNoLlxyXG4gICAqIEBwYXJhbSB6X2luZGV4IEluZGV4IGluIGFycmF5IG9mIGFsbCBjaGlsZHJlbiBpbiB0aGlzIGVudGl0eS4gVGhlIGhpZ2hlciBnZXRzIHJlbmRlcmQgbGF0ZXIuXHJcbiAgICogQHJldHVybnMgVGhlIHBvc2l0aW9uIGdpdmVuIGNoaWxkIGVudGl0eSBpcyBwdXQuXHJcbiAgICovXHJcbiAgcHVibGljIGF0dGFjaENoaWxkcmVuKFxyXG4gICAgY2hpbGRyZW46IEVudGl0eVtdIHwgRW50aXR5LFxyXG4gICAgel9pbmRleDogbnVtYmVyID0gSW5maW5pdHlcclxuICApOiBudW1iZXIge1xyXG4gICAgbGV0IGxhc3RJbmRleDogbnVtYmVyID0gLTE7XHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjaGlsZHJlbikpIHtcclxuICAgICAgY29uc3Qgc2FmZUluZGV4ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oel9pbmRleCwgdGhpcy5jaGlsZHJlbi5sZW5ndGgpKTtcclxuICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGNoaWxkcmVuLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgIGxhc3RJbmRleCA9IHRoaXMuYXR0YWNoQ2hpbGRyZW4oY2hpbGRyZW5baW5kZXhdLCBzYWZlSW5kZXggKyBpbmRleCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGZvciAoXHJcbiAgICAgICAgbGV0IHRlbXBQYXJlbnQ6IEVudGl0eSB8IG51bGwgPSB0aGlzO1xyXG4gICAgICAgIHRlbXBQYXJlbnQgIT09IG51bGw7XHJcbiAgICAgICAgdGVtcFBhcmVudCA9IHRlbXBQYXJlbnQucGFyZW50XHJcbiAgICAgICkge1xyXG4gICAgICAgIGlmICh0ZW1wUGFyZW50ID09PSBjaGlsZHJlbikge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTG9vcCBvZiBwYXJlbnQtY2hpbGQgcmVsYXRpb25zaGlwcyBkZXRlY3RlZC5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGNoaWxkcmVuLnBhcmVudD8uZGV0YWNoQ2hpbGRyZW4oY2hpbGRyZW4pO1xyXG4gICAgICAvLyBUT0RPOiBNYXliZSBnb29kIGlmIHRoZXJlJ3Mgb3B0aW9uIHdoaWNoIGRlY2lkZXNcclxuICAgICAgLy8gICAgICAgd2hldGhlciBpdCBkZXRhY2hlcyBhbmQgcmUtYXR0YWNoZXMgb3IgdGhyb3dzIGVycm9yXHJcbiAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZHJlbik7XHJcbiAgICAgIGNoaWxkcmVuLnBhcmVudCA9IHRoaXM7XHJcbiAgICAgIGxhc3RJbmRleCA9IHRoaXMuc2V0Q2hpbGRJbmRleChjaGlsZHJlbiwgel9pbmRleCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbGFzdEluZGV4OyAvLyBpZiByZXR1cm5zIC0xLCBlbXB0eSBhcnJheSBoYXMgYmVlbiBpbnB1dC5cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbW92ZXMgcGFyZW50LWNoaWxkIHJlbGF0aW9uIGJldHdlZW4gdGhpcyBlbnRpdHkgYW5kIGVudGl0aWVzIHBhc3NlZCB0aHJvdWdoIHRoZSBwYXJhbWV0ZXIuXHJcbiAgICogQHBhcmFtIGNoaWxkcmVuIFNpbmdsZSBlbnRpdHkgb3IgYW4gYXJyYXkgb2YgZW50aXRpZXMgdG8gZGV0dGFjaC5cclxuICAgKi9cclxuICBwdWJsaWMgZGV0YWNoQ2hpbGRyZW4oY2hpbGRyZW46IEVudGl0eVtdIHwgRW50aXR5KSB7XHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjaGlsZHJlbikpIHtcclxuICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBjaGlsZHJlbikge1xyXG4gICAgICAgIHRoaXMuZGV0YWNoQ2hpbGRyZW4oY2hpbGQpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBpbmRleCA9IHRoaXMuY2hpbGRyZW4uaW5kZXhPZihjaGlsZHJlbik7XHJcbiAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIGNoaWxkcmVuLnBhcmVudCA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHJpZXZlcyBjaGlsZCBpbmRleCBvZiB0aGUgZW50aXR5IHBhc3NlZCB0aHJvdWdoIHRoZSBwYXJhbWV0ZXIgaW4gdGhlIGNoaWxkcmVuIGxpc3Qgb2YgdGhpcyBlbnRpdHkuXHJcbiAgICogSWYgY2hpbGRyZW4gcGFzc2VkIGlzIG5vdCBjaGlsZCBvZiB0aGlzIGluc3RhbmNlLCBhbiBlcnJvciBpcyB0aHJvd24uXHJcbiAgICogQHBhcmFtIGNoaWxkIFNpbmdsZSBlbnRpdHkgd2hpY2ggcmVxdWlyZSB0aGUgaW5kZXguXHJcbiAgICogQHJldHVybnMgVGhlIHBvc2l0aW9uIG9mIHRoZSBnaXZlbiBjaGlsZCBlbnRpdHkuXHJcbiAgICovXHJcbiAgcHVibGljIGdldENoaWxkSW5kZXgoY2hpbGQ6IEVudGl0eSk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5jaGlsZHJlbi5pbmRleE9mKGNoaWxkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEJhc2VkIG9uIGFscmVhZHkgZXhpc3RpbmcgcGFyZW50LWNoaWxkIHJlbGF0aW9uLCB0aGlzIG1ldGhvZCBtb2RpZmllcyB0aGUgaW5kZXggb2YgZ2l2ZW4gY2hpbGQgaW4gdGhlIGNoaWxkcmVuIGxpc3Qgb2YgdGhpcyBlbnRpdHkuXHJcbiAgICogQHBhcmFtIGNoaWxkIFNpbmdsZSBlbnRpdHkgdG8gbW9kaWZ5IGluZGV4LlxyXG4gICAqIEBwYXJhbSB6X2luZGV4IEluZGV4IGluIGFycmF5IG9mIGNoaWxkcmVuIGluIHRoaXMgZW50aXR5LiBUaGUgaGlnaGVyIGdldHMgcmVuZGVyZCBsYXRlci5cclxuICAgKiBAcmV0dXJucyBUaGUgcG9zaXRpb24gZ2l2ZW4gY2hpbGQgZW50aXR5IGlzIG1vdmVkIHRvLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRDaGlsZEluZGV4KGNoaWxkOiBFbnRpdHksIGluZGV4OiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgY29uc3QgY3VycmVudEluZGV4ID0gdGhpcy5nZXRDaGlsZEluZGV4KGNoaWxkKTtcclxuICAgIGlmIChjdXJyZW50SW5kZXggPT09IC0xKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkkgQU0gTk9UIFlPVVIgRkFUSEVSXCIpOyAvLyB0b2RvOiBiZXR0ZXIgZXJyb3IgbWVzc2FnZT9cclxuICAgIH1cclxuICAgIHRoaXMuY2hpbGRyZW4uc3BsaWNlKGN1cnJlbnRJbmRleCwgMSk7XHJcbiAgICBjb25zdCBzYWZlSW5kZXggPSBNYXRoLm1heCgwLCBNYXRoLm1pbihpbmRleCwgdGhpcy5jaGlsZHJlbi5sZW5ndGgpKTtcclxuICAgIHRoaXMuY2hpbGRyZW4uc3BsaWNlKHNhZmVJbmRleCwgMCwgY2hpbGQpO1xyXG4gICAgcmV0dXJuIHNhZmVJbmRleDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFsaWFzIG9mIGF0dGFjaENoaWxkcmVuLiB0aGlzIGVudGl0eSBpcyBkZXR0YWNoZWQgZnJvbSBwYXJlbnQgaWYgbnVsbCBpcyBwYXNzZWQuXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBUaGUgZm9sbG93aW5nIHR3byBsaW5lc2Ugb2YgY29kZSBtZWFucyBleGFjdGx5IHNhbWUuXHJcbiAgICogYGBgdHNcclxuICAgKiBBLnNldFBhcmVudChCKTtcclxuICAgKiBCLmF0dGFjaENoaWxkcmVuKEEpO1xyXG4gICAqIGBgYFxyXG4gICAqIEBwYXJhbSBwYXJlbnQgcGFyZW50IGluc3RhbmNlIHRvIHNldCBhcyBwYXJlbnQgb2YgdGhpcyBlbnRpdHkuXHJcbiAgICovXHJcbiAgcHVibGljIHNldFBhcmVudChwYXJlbnQ6IEVudGl0eSB8IG51bGwgPSBudWxsKSB7XHJcbiAgICBpZiAocGFyZW50ID09IG51bGwpIHtcclxuICAgICAgdGhpcy5wYXJlbnQ/LmRldGFjaENoaWxkcmVuKHRoaXMpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcGFyZW50LmF0dGFjaENoaWxkcmVuKHRoaXMpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCAoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKSA9PiB7XHJcbiAgaWYgKCg8YW55PmNvbnRleHQpLnJlc2V0ICE9IG51bGwpIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLy8gQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEI3Jlc2V0IGlzIGEgZXhwZXJpbWVudGFsIG1ldGhvZC4gd2hpY2ggbWF5IG5vdCBiZSBpbmNsdWRlZCBpbiBzb21lIGJyb3dzZXJzIGluY2x1ZGluZyBmaXJlZm94LlxyXG4gIC8vIFRoaXMgYmxvY2sgd2lsbCBjcmVhdGUgcmVzZXQgbWV0aG9kIG1vY2tpbmcgdGhlIGJlaGF2aW9yIGRlc2NyaWJlZCBpbiBDaHJvbWl1bSBzb3VyY2UgY29kZS5cclxuICAvLyBJbiBvcmRlciB0byBrZWVwIHRyYWNrIG9mIGRlZmF1bHQgc3RhdGUgc3RhY2sgaW4gY29udGV4dCwgcmVsZXZhbnQgbWV0aG9kcyBhcmUgbW9kaWZlaWVkL2FkZGVkIGFzIGEgc2lkZSBlZmZlY3QuXHJcbiAgY29udGV4dC5zYXZlKCk7XHJcbiAgbGV0IHN0YXRlQ291bnQgPSAwO1xyXG5cclxuICBjb25zdCB0ZW1wU2F2ZSA9IGNvbnRleHQuc2F2ZTtcclxuICBjb25zdCB0ZW1wUmVzdG9yZSA9IGNvbnRleHQucmVzdG9yZTtcclxuXHJcbiAgY29udGV4dC5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGVtcFNhdmUuY2FsbCh0aGlzKTtcclxuICAgIHN0YXRlQ291bnQrKztcclxuICB9O1xyXG5cclxuICBjb250ZXh0LnJlc3RvcmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAoc3RhdGVDb3VudCA+IDApIHtcclxuICAgICAgdGVtcFJlc3RvcmUuY2FsbCh0aGlzKTtcclxuICAgICAgc3RhdGVDb3VudC0tO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IHJlc3RvcmVSb290ID0gZnVuY3Rpb24gKF9jb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpIHtcclxuICAgIGZvciAobGV0IGNvdW50ID0gc3RhdGVDb3VudDsgY291bnQgPiAtMTsgY291bnQtLSkge1xyXG4gICAgICB0ZW1wUmVzdG9yZS5jYWxsKF9jb250ZXh0KTtcclxuICAgIH1cclxuICAgIHN0YXRlQ291bnQgPSAtMTtcclxuICB9O1xyXG5cclxuICAoPGFueT5jb250ZXh0KS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJlc3RvcmVSb290KGNvbnRleHQpO1xyXG4gICAgdGhpcy5tb3ZlVG8oMCwgMCk7XHJcbiAgICB0aGlzLmJlZ2luUGF0aCgpO1xyXG4gICAgdGhpcy5jbG9zZVBhdGgoKTtcclxuICAgIHRoaXMucmVzZXRUcmFuc2Zvcm0oKTtcclxuICAgIHRoaXMuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xyXG4gICAgdGhpcy5zYXZlKCk7XHJcbiAgfTtcclxuICByZXR1cm4gZmFsc2U7XHJcbn07XHJcbiIsImltcG9ydCB7IEVudGl0eSB9IGZyb20gXCIuLi9lbnRpdHlcIjtcclxuaW1wb3J0IElEcmF3YWJsZSBmcm9tIFwiLi9pZHJhd2FibGVcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFic3RyYWN0IGNsYXNzIFNwcml0ZSBleHRlbmRzIEVudGl0eSBpbXBsZW1lbnRzIElEcmF3YWJsZSB7XHJcbiAgcHJpdmF0ZSByZWdpb246IEVudGl0eSB8IHVuZGVmaW5lZDtcclxuXHJcbiAgLyoqXHJcbiAgICogR2V0dGVyIHByb3BlcnR5IGZvciByZWdpb24uXHJcbiAgICogQHJldHVybnMgVGhlIGRyYXdpbmcgcmVnaW9uIHRoaXMgc3ByaXRlIGlzIGluZGljYXRpbmcuIFNwcml0ZXMgYXJlIGNsaXBwZWQgYnkgdGhlaXIgcmVnaW9uLlxyXG4gICAqIEBzZWUgW0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCNjbGlwXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEL2NsaXApXHJcbiAgICovXHJcbiAgcHVibGljIGdldCBSZWdpb24oKTogRW50aXR5IHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiB0aGlzLnJlZ2lvbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEByZXR1cm5zIEJvb2xlYW4gdGhhdCBkZXRlcm1pbmVzIHdoZXRoZXIgdGhlIHJlZ2lvbiBvZiB0aGlzIHNwcml0ZSBpbmRpY2F0ZXMgaXQgc2VsZi5cclxuICAgKiBAc2VlIHtAbGluayBSZWdpb259XHJcbiAgICovXHJcbiAgcHVibGljIGdldCBpc1NlbGZSZWdpb24oKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5yZWdpb24gPT09IHRoaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXR0ZXIgcHJvcGVydHkgZm9yIHJlZ2lvbi5cclxuICAgKi9cclxuICBwdWJsaWMgc2V0IFJlZ2lvbihyZWdpb246IEVudGl0eSB8IHVuZGVmaW5lZCkge1xyXG4gICAgdGhpcy5yZWdpb24gPSByZWdpb247XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAaW5oZXJpdGRvY1xyXG4gICAqL1xyXG4gIHB1YmxpYyByZWFkb25seSBkcmF3ID0gKGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgZGVsYXk6IG51bWJlcikgPT4ge1xyXG4gICAgY29udGV4dC5zYXZlKCk7XHJcbiAgICBpZiAodGhpcy5yZWdpb24pIHtcclxuICAgICAgdGhpcy5iZWZvcmVDbGlwKGNvbnRleHQsIGRlbGF5KTtcclxuICAgICAgY29udGV4dC5iZWdpblBhdGgoKTtcclxuICAgICAgY29udGV4dC5yZWN0KFxyXG4gICAgICAgIHRoaXMucmVnaW9uLkFic29sdXRlWCxcclxuICAgICAgICB0aGlzLnJlZ2lvbi5BYnNvbHV0ZVksXHJcbiAgICAgICAgdGhpcy5yZWdpb24uV2lkdGgsXHJcbiAgICAgICAgdGhpcy5yZWdpb24uSGVpZ2h0XHJcbiAgICAgICk7XHJcbiAgICAgIGNvbnRleHQuY2xpcCgpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5vbkRyYXcoY29udGV4dCwgZGVsYXkpO1xyXG4gICAgY29udGV4dC5yZXN0b3JlKCk7XHJcbiAgICB0aGlzLmFmdGVyUmVzdG9yZShjb250ZXh0LCBkZWxheSk7XHJcbiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXMuQ2hpbGRyZW4pIHtcclxuICAgICAgaWYgKCEoY2hpbGQgaW5zdGFuY2VvZiBTcHJpdGUpKSBjb250aW51ZTtcclxuICAgICAgY2hpbGQuZHJhdyhjb250ZXh0LCBkZWxheSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogUHJlLWNsaXAgdGFza3MgcGVyZm9ybWVkIGZvciBjYW52YXMgY29udGV4dCByZXNldC5cclxuICAgKiB0aGlzIG1ldGhvZCBpcyBjYWxsZWQgYXV0b21hdGljYWxseSBieSBlbmdpbmUgaWYgYXR0YWNoZWQuXHJcbiAgICogQHBhcmFtIGNvbnRleHQgQ2FudmFzIGNvbnRleHQgdG8gcGVyZm9ybSByZXNldCBvbi5cclxuICAgKiBAcGFyYW0gZGVsYXkgdGltZSBpbiBtaWxsaXNlY29uZHMgcGFzc2VkIGZyb20gdGhlIHByZXZpb3VzIGZyYW1lIGNhbGwuXHJcbiAgICovXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xyXG4gIHB1YmxpYyBiZWZvcmVDbGlwKGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgZGVsYXk6IG51bWJlcikge31cclxuXHJcbiAgLyoqXHJcbiAgICogUG9zdC1yZXN0b3JlIHRhc2tzIHBlcmZvcm1lZCBmb3IgY2FudmFzIGNvbnRleHQgcmVzdG9yZS5cclxuICAgKiB0aGlzIG1ldGhvZCBpcyBjYWxsZWQgYXV0b21hdGljYWxseSBieSBlbmdpbmUgaWYgYXR0YWNoZWQuXHJcbiAgICogQHBhcmFtIGNvbnRleHQgQ2FudmFzIGNvbnRleHQgdG8gcGVyZm9ybSByZXNldCBvbi5cclxuICAgKiBAcGFyYW0gZGVsYXkgdGltZSBpbiBtaWxsaXNlY29uZHMgcGFzc2VkIGZyb20gdGhlIHByZXZpb3VzIGZyYW1lIGNhbGwuXHJcbiAgICovXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xyXG4gIHB1YmxpYyBhZnRlclJlc3RvcmUoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCBkZWxheTogbnVtYmVyKSB7fVxyXG5cclxuICAvKipcclxuICAgKiBSZW5kZXIgdGFza3MgcGVyZm9ybWVkIGZvciBjYW52YXMgY29udGV4dC5cclxuICAgKiB0aGlzIG1ldGhvZCBpcyBjYWxsZWQgYXV0b21hdGljYWxseSBieSBlbmdpbmUgaWYgYXR0YWNoZWQuXHJcbiAgICogQHBhcmFtIGNvbnRleHQgQ2FudmFzIGNvbnRleHQgdG8gcGVyZm9ybSByZXNldCBvbi5cclxuICAgKiBAcGFyYW0gZGVsYXkgdGltZSBpbiBtaWxsaXNlY29uZHMgcGFzc2VkIGZyb20gdGhlIHByZXZpb3VzIGZyYW1lIGNhbGwuXHJcbiAgICovXHJcbiAgcHVibGljIGFic3RyYWN0IG9uRHJhdyhcclxuICAgIGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCxcclxuICAgIGRlbGF5OiBudW1iZXJcclxuICApOiB2b2lkO1xyXG59XHJcbiIsImltcG9ydCB7IFNwcml0ZSB9IGZyb20gXCIuLi9zcHJpdGVcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJsYW5rU2NlbmUgZXh0ZW5kcyBTcHJpdGUge1xyXG4gIHB1YmxpYyBvbkRyYXcoKTogdm9pZCB7fVxyXG59XHJcbiIsImltcG9ydCBDYW52YXNDb25maWcgZnJvbSBcIi4vY2FudmFzX2NvbmZpZ1wiO1xyXG5pbXBvcnQgeyBFbnRpdHkgfSBmcm9tIFwiLi9lbnRpdHlcIjtcclxuaW1wb3J0IHsgSURyYXdhYmxlIH0gZnJvbSBcIi4vc3ByaXRlXCI7XHJcbmltcG9ydCB7IFZlY3RvcjJEIH0gZnJvbSBcIi4vdmVjdG9yXCI7XHJcbmltcG9ydCBjaGVja0NvbXBhdGliaWxpdHkgZnJvbSBcIi4vY29tcGF0aWJpbGl0eVwiO1xyXG5pbXBvcnQgeyBCbGFua1NjZW5lIH0gZnJvbSBcIi4vc2NlbmVzXCI7XHJcblxyXG5pbnRlcmZhY2UgRXh0ZW5kZWRDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgZXh0ZW5kcyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQge1xyXG4gIHJlc2V0KCk6IHZvaWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEVuZ2luZSB7XHJcbiAgcHJpdmF0ZSBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xyXG5cclxuICBwcml2YXRlIGNvbnRleHQ6IEV4dGVuZGVkQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xyXG5cclxuICBwcml2YXRlIHN1YlJlc2V0OiAoY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKSA9PiB2b2lkO1xyXG5cclxuICBwcml2YXRlIHByZXZpb3VzVGltZXN0YW1wOiBudW1iZXIgPSAwO1xyXG5cclxuICBwcml2YXRlIGFuaW1hdGlvbklkOiBudW1iZXIgPSAtMTtcclxuXHJcbiAgcHJpdmF0ZSBzY2VuZTogSURyYXdhYmxlID0gbmV3IEJsYW5rU2NlbmUoKTtcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKGNhbnZhc0lkZW50aWZpZXI6IEhUTUxDYW52YXNFbGVtZW50IHwgc3RyaW5nIHwgbnVsbCkge1xyXG4gICAgLy8gbG9jYXRlIGNhbnZhcyBieSBIVE1MQ2FudmFzRWxlbWVudCBvciBDU1Mgc2VsZWN0b3JcclxuICAgIGxldCBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50IHwgbnVsbDtcclxuICAgIGlmICh0eXBlb2YgY2FudmFzSWRlbnRpZmllciA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgIGNhbnZhc0lkZW50aWZpZXJcclxuICAgICAgKSBhcyBIVE1MQ2FudmFzRWxlbWVudCB8IG51bGw7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjYW52YXMgPSBjYW52YXNJZGVudGlmaWVyO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChjYW52YXMgPT09IG51bGwpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIGlkZW50aWZ5IGNhbnZhcy5cIik7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XHJcbiAgICB0aGlzLnN1YlJlc2V0ID0gKCkgPT4ge307XHJcblxyXG4gICAgLy8gcmVxdWVzdCBjb250ZXh0IGZyb20gZ2l2ZW4gY2FudmFzXHJcbiAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dChcclxuICAgICAgXCIyZFwiXHJcbiAgICApIGFzIEV4dGVuZGVkQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xyXG5cclxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XHJcblxyXG4gICAgY2hlY2tDb21wYXRpYmlsaXR5KHRoaXMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBDYW52YXMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jYW52YXM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IENvbnRleHQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jb250ZXh0O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBTY2VuZSgpOiBJRHJhd2FibGUge1xyXG4gICAgcmV0dXJuIHRoaXMuc2NlbmU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IFNjZW5lKHNjZW5lOiBJRHJhd2FibGUpIHtcclxuICAgIGlmIChzY2VuZSBpbnN0YW5jZW9mIEVudGl0eSkge1xyXG4gICAgICBzY2VuZS5zZXRQYXJlbnQobnVsbCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNjZW5lID0gc2NlbmU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0U3ViUmVzZXRGdW5jdGlvbihcclxuICAgIGZ1bmM6IChjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpID0+IHZvaWRcclxuICApIHtcclxuICAgIHRoaXMuc3ViUmVzZXQgPSBmdW5jO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlc2l6ZUNhbnZhcyhjb25maWc/OiBDYW52YXNDb25maWcgfCBWZWN0b3IyRCkge1xyXG4gICAgaWYgKGNvbmZpZyBpbnN0YW5jZW9mIFZlY3RvcjJEKSB7XHJcbiAgICAgIHRoaXMuQ2FudmFzLndpZHRoID0gY29uZmlnLlg7XHJcbiAgICAgIHRoaXMuQ2FudmFzLmhlaWdodCA9IGNvbmZpZy5ZO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5DYW52YXMud2lkdGggPSBjb25maWc/LncgPz8gd2luZG93LmlubmVyV2lkdGg7XHJcbiAgICAgIHRoaXMuQ2FudmFzLmhlaWdodCA9IGNvbmZpZz8uaCA/PyB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICB9XHJcbiAgICAvLyBUT0RPOiBlbWl0IGNhbnZhcyByZXNpemUgZXZlbnRcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGFydCgpIHtcclxuICAgIC8vIG1heSBiZSBlcnJvciBjaGVjay5cclxuICAgIHRoaXMucmVuZGVyKHRoaXMucHJldmlvdXNUaW1lc3RhbXApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0b3AoKSB7XHJcbiAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLmFuaW1hdGlvbklkKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVuZGVyKHRpbWVzdGFtcDogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBlbGFwc2VkVGltZSA9IHRpbWVzdGFtcCAtIHRoaXMucHJldmlvdXNUaW1lc3RhbXA7XHJcbiAgICB0aGlzLnByZXZpb3VzVGltZXN0YW1wID0gdGltZXN0YW1wO1xyXG5cclxuICAgIHRoaXMuY29udGV4dC5yZXNldCgpO1xyXG4gICAgdGhpcy5zdWJSZXNldCh0aGlzLmNvbnRleHQpO1xyXG5cclxuICAgIHRoaXMuc2NlbmU/LmRyYXcodGhpcy5jb250ZXh0LCBlbGFwc2VkVGltZSk7XHJcblxyXG4gICAgdGhpcy5hbmltYXRpb25JZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnJlbmRlci5iaW5kKHRoaXMpKTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IEVuZ2luZSBmcm9tIFwiLi4vZW5naW5lXCI7XHJcbmltcG9ydCBjb250ZXh0UmVzZXQgZnJvbSBcIi4vY29udGV4dF9yZXNldFwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgKGVuZ2luZTogRW5naW5lKSA9PiB7XHJcbiAgY29uc3QgY29tcGF0T2JqZWN0ID0ge1xyXG4gICAgY29udGV4dF9yZXNldDogY29udGV4dFJlc2V0KGVuZ2luZS5Db250ZXh0KSxcclxuICB9O1xyXG4gIE9iamVjdC5mcmVlemUoY29tcGF0T2JqZWN0KTtcclxuICByZXR1cm4gY29tcGF0T2JqZWN0O1xyXG59O1xyXG4iLCJpbXBvcnQgVmVjdG9yIGZyb20gXCIuL3ZlY3RvclwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmVjdG9yM0QgZXh0ZW5kcyBWZWN0b3Ige1xyXG4gIGNvbnN0cnVjdG9yKHg6IG51bWJlciA9IDAsIHk6IG51bWJlciA9IDAsIHo6IG51bWJlciA9IDApIHtcclxuICAgIHN1cGVyKHgsIHksIHopO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBYKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudmFsdWVzWzBdO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBZKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudmFsdWVzWzFdO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBaKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudmFsdWVzWzJdO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBYKHg6IG51bWJlcikge1xyXG4gICAgdGhpcy52YWx1ZXNbMF0gPSB4O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBZKHk6IG51bWJlcikge1xyXG4gICAgdGhpcy52YWx1ZXNbMV0gPSB5O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBaKHo6IG51bWJlcikge1xyXG4gICAgdGhpcy52YWx1ZXNbMl0gPSB6O1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgVmVjdG9yIGZyb20gXCIuL3ZlY3RvclwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmVjdG9yNEQgZXh0ZW5kcyBWZWN0b3Ige1xyXG4gIGNvbnN0cnVjdG9yKHg6IG51bWJlciA9IDAsIHk6IG51bWJlciA9IDAsIHo6IG51bWJlciA9IDAsIHc6IG51bWJlciA9IDApIHtcclxuICAgIHN1cGVyKHgsIHksIHosIHcpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBYKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudmFsdWVzWzBdO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBZKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudmFsdWVzWzFdO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBaKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudmFsdWVzWzJdO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBXKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudmFsdWVzWzNdO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBYKHg6IG51bWJlcikge1xyXG4gICAgdGhpcy52YWx1ZXNbMF0gPSB4O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBZKHk6IG51bWJlcikge1xyXG4gICAgdGhpcy52YWx1ZXNbMV0gPSB5O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBaKHo6IG51bWJlcikge1xyXG4gICAgdGhpcy52YWx1ZXNbMl0gPSB6O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBXKHc6IG51bWJlcikge1xyXG4gICAgdGhpcy52YWx1ZXNbM10gPSB3O1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImV4cG9ydHMiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwiVmVjdG9yIiwiY29uc3RydWN0b3IiLCJ2YWx1ZXMiLCJ0aGlzIiwic2l6ZSIsImxlbmd0aCIsIlNpemUiLCJjb3B5IiwidG8iLCJmb3JjZSIsIkVycm9yIiwib3ZlcndyaXRlIiwiaXNlcXVhbCIsIm90aGVyIiwicHJlY2lzZSIsInRoaXNBcnJheSIsInNsaWNlIiwib3RoZXJBcnJheSIsImV2ZXJ5IiwidiIsImkiLCJ0b0ZpeGVkIiwic2hpZnQiLCJtb3ZlIiwidGVtcCIsInVuc2hpZnQiLCJjb3VudGVyIiwibWFwIiwiVmVjdG9yMkQiLCJ4IiwieSIsInN1cGVyIiwiWCIsIlkiLCJFbnRpdHkiLCJjb25maWciLCJjaGlsZHJlbiIsInBhcmVudCIsImRpbWVuc2lvbiIsInBvc2l0aW9uIiwiVyIsIkgiLCJQb3NpdGlvbiIsIkFic29sdXRlWCIsIkFic29sdXRlWSIsIkRpbWVuc2lvbiIsIldpZHRoIiwiSGVpZ2h0IiwiUGFyZW50IiwiQ2hpbGRyZW4iLCJ3aWR0aCIsImhlaWdodCIsImF0dGFjaENoaWxkcmVuIiwiel9pbmRleCIsIkluZmluaXR5IiwibGFzdEluZGV4IiwiQXJyYXkiLCJpc0FycmF5Iiwic2FmZUluZGV4IiwiTWF0aCIsIm1heCIsIm1pbiIsImluZGV4IiwidGVtcFBhcmVudCIsImRldGFjaENoaWxkcmVuIiwicHVzaCIsInNldENoaWxkSW5kZXgiLCJjaGlsZCIsImluZGV4T2YiLCJzcGxpY2UiLCJnZXRDaGlsZEluZGV4IiwiY3VycmVudEluZGV4Iiwic2V0UGFyZW50IiwiY29udGV4dCIsInJlc2V0Iiwic2F2ZSIsInN0YXRlQ291bnQiLCJ0ZW1wU2F2ZSIsInRlbXBSZXN0b3JlIiwicmVzdG9yZSIsIl9jb250ZXh0IiwiY291bnQiLCJyZXN0b3JlUm9vdCIsIm1vdmVUbyIsImJlZ2luUGF0aCIsImNsb3NlUGF0aCIsInJlc2V0VHJhbnNmb3JtIiwiY2xlYXJSZWN0IiwiY2FudmFzIiwiU3ByaXRlIiwiZHJhdyIsImRlbGF5IiwicmVnaW9uIiwiYmVmb3JlQ2xpcCIsInJlY3QiLCJjbGlwIiwib25EcmF3IiwiYWZ0ZXJSZXN0b3JlIiwiUmVnaW9uIiwiaXNTZWxmUmVnaW9uIiwiQmxhbmtTY2VuZSIsIkVuZ2luZSIsImNhbnZhc0lkZW50aWZpZXIiLCJwcmV2aW91c1RpbWVzdGFtcCIsImFuaW1hdGlvbklkIiwic2NlbmUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzdWJSZXNldCIsImdldENvbnRleHQiLCJlbmdpbmUiLCJjb21wYXRPYmplY3QiLCJjb250ZXh0X3Jlc2V0IiwiQ29udGV4dCIsImZyZWV6ZSIsIkNhbnZhcyIsIlNjZW5lIiwic2V0U3ViUmVzZXRGdW5jdGlvbiIsImZ1bmMiLCJyZXNpemVDYW52YXMiLCJ3Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsImgiLCJpbm5lckhlaWdodCIsInN0YXJ0IiwicmVuZGVyIiwic3RvcCIsImNhbmNlbEFuaW1hdGlvbkZyYW1lIiwidGltZXN0YW1wIiwiZWxhcHNlZFRpbWUiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJiaW5kIiwiVmVjdG9yM0QiLCJ6IiwiWiIsIlZlY3RvcjREIl0sInNvdXJjZVJvb3QiOiIifQ==